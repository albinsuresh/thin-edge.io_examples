version: "3.2"

services:
  gateway:
    # Image is maintained under: https://github.com/thin-edge/opcua-device-gateway-container
    image: ghcr.io/thin-edge/opcua-device-gateway:20240106.0203
    restart: always
    environment:
      # OPCUA Gateway info
      - OPCUA_GATEWAY_IDENTIFIER=${OPCUA_GATEWAY_IDENTIFIER:-RpiOPCUAGateway001}
      - OPCUA_GATEWAY_NAME=${OPCUA_GATEWAY_NAME:-RPI_OPCUA_GATEWAY_AGENT}

      # thin-edge.io MQTT broker
      - MQTT_BROKER=host.docker.internal:1883
      - DEVICE_ID=${DEVICE_ID:-}
      - C8Y_BASEURL=${C8Y_BASEURL:-}
    volumes:
      - opcua_data:/data
      # Provide access to thin-edge.io configuration
      - /etc/tedge:/etc/tedge
      - /etc/tedge/device-certs:/etc/tedge/device-certs
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - backend

volumes:
  opcua_data:

networks:
  backend:
